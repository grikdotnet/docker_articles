Docker myths and recipes. Data Volume container.
========
*незаконченная статья*

Начало: https://github.com/grikdotnet/docker_articles/blob/master/docker1.md

В docker есть любопытный инструмент, который называется [Data Volume сontainer](https://docs.docker.com/userguide/dockervolumes/#creating-and-mounting-a-data-volume-container). 
У меня он ассоциациируется с data transfer object.

Вот что нужно знать про тома в docker:
* Data Volume - это подмонтированный в контейнер каталог, внешний для контейнера.
* Если не указать какой каталог монтировать, будет создан новый каталог в /var/lib/docker/volumes/ с непредсказуемым 64-символьным названием.
* При удалении контейнера volume-каталоги не удаляются. Создавая контейнеры с томами и удаляя затем контейнеры, можно замусорить /var/lib/docker/volumes/ - разобораться к чему относился конкретный каталог можно будет в лучшем случае по логам docker.
* В каталог /var/lib/docker/volumes/ доступ есть только для рута, так что просмотреть содержимое автоматически созданных томов можно через `sudo`
* Удобнее монтировать свои каталоги чтобы просматривать их содержимое и удалять при ненужности.
* Данные из тома не экспортируются при выполнении `docker export`, `docker save` и не сохранятся в образ командой `docker commit`.

Перефразируя "Адвокат дьявола", авторы docker дают нам тома в контейнерах, дарят этот экстраординарный подарок, а потом для своего ролика космических трюков устанавливает противоположные правила игры.
Расшаривай между контейнерами - но не сможешь удалить. Монтируй свою папку и удаляй - но не распространяй в образе. Копируй в образ и распространяй - но не расшаривай между контейнерами! И пока мы прыгаем с одной ноги на другую, думая, как автоматизировать создание контейнера, который будет использовать каталог из другого контейнера, что делают авторы docker? Вероятно, хотят чтобы мы заплатили им за хранение изображений со своими приложениями :)

Несмотря на проблему, использовать в контейнерах общие разделяемые каталоги для хранения данных настолько удобно, что надо придумать решение как распространять несколько контейнеров вместе с разделяемыми каталогами.

В документации предлагают создавать volume container из образа операционной системы или базы данных.
Если такой контейнер экспортировать, в файл пойдет вся операционная система. Наследование от образа mysql добавит к размеру архива порядка 66 мегабайт при сжатии xz. Чтобы избежать этого я создаю контейнер от [Busybox](https://hub.docker.com/r/library/busybox/) - он позволяет выполнять простые команды, открывать терминал в контейнере и добавляет в архив менее мегабайта.

```console
$ mkdir data_volume
$ cd data_volume/
$ echo "FROM busybox">Dockerfile
$ echo "FROM busybox">Dockerfile
$ docker build -t grikdotnet/data_volume .
$ cd ..; rm -rf data_volume/
$ mkdir application
$ docker create --name mysql_data -v "$(pwd)/mysql_data:/var/lib/mysql" -t grikdotnet/data_volume
```

